<html>
<head>
<script language="javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script language="javascript" src="../dd.js/foundation.js"></script>
<script language="javascript" src="../dd.js/adapter-jquery.js"></script>
<script language="javascript" src="../dd.js/binding.js"></script>
<script language="javascript" src="../dd.js/view.js"></script>
<script language="javascript">
    var B = { };
    
    B.attr = function (element, name, value) {
        var attr = element.attributes.getNamedItem(name);
        if (attr == null) {
            attr = document.createAttribute(name);
            element.attributes.setNamedItem(attr);
        }
        attr.value = value;
    };
    
    var dataContext = null;
    var listContext = null;
    
    function onReady() {
        var root = document.getElementById("root");
        
        var tpl_item = document.getElementById("tpl_item").innerHTML;
        var tpl = DD.templateFromHtml(tpl_item);
        var view = new DD.View(tpl);
        
        view.attach(root);
        
        var data = {
            icon: "res/wizard.png",
            caption: "My",
            subtitle: "world"
        };
        
        dataContext = DD.createDataContext(data);
        var dataSource = new DD.DataSource(dataContext);
        
        view.subscribe(dataSource);
        
        var viewlist = new DD.ViewList(tpl);
        viewlist.attach(document.getElementById("list"));
        
        var listdata = [
            {
                icon: "res/tag_blue.png",
                caption: "A",
                subtitle: "a"
            }
        ];
        
        listContext = DD.createDataContext(listdata);
        
        viewlist.subscribe(new DD.DataSource(listContext));
    }
    
    function onCaptionChange() {
        var text = document.getElementById("caption");
        var data = dataContext.data();
        data.caption = text.value;
        dataContext.update();
    }
    
    function onAddItem() {
        var caption = document.getElementById("caption").value;
        var data = {
            icon: "res/tag_orange.png",
            caption: caption,
            subtitle: caption.toLowerCase()
        };
        listContext.append(data);
    }

    function onDelItem() {
        var index = parseInt(document.getElementById("index").value);
        if (index >= 0) {
            listContext.remove(index);
        }
    }
    
    function onInsItem() {
        var index = parseInt(document.getElementById("index").value);
        if (index >= 0) {
            var caption = document.getElementById("caption").value;
            var data = {
                icon: "res/tag_green.png",
                caption: caption,
                subtitle: caption.toLowerCase()
            };
            listContext.insert(data, index);
        }
        
    }
    
    function onClrItems() {
        listContext.clear();
    }
    
    DD.ready(onReady);
</script>

</head>
<body>
<div id="content">
    <div id="root"></div>
    <div>
        <input id="caption" type="text" onchange="onCaptionChange()" />
        <input type="button" value="Add" onclick="onAddItem()" />
        <input id="index" type="text" size="3" />
        <input type="button" value="Ins" onclick="onInsItem()" />
        <input type="button" value="Del" onclick="onDelItem()" />
        <input type="button" value="Clr" onclick="onClrItems()" />
    </div>
    <div id="list"></div>
</div>
<div style="display:none">
    <div id="tpl_item">
        <table>
            <tr><td rowspan="2"><img src="" bind:x="B.attr($E, 'src', $D.icon)" /></td><td>Caption - {?= $D.caption ?}</td></tr>
            <tr><td>Subtitle - {?= $D.subtitle ?}</td></tr>
        </table>
    </div>
</div>
</body>
</html>

